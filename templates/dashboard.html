{% include 'layout/base.html' %}
{% include 'layout/sidebar.html' %}

{% block content %}
    <!-- Include the sidebar -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!--start content-->
    <main class="page-content">
        <div class="row mt-4">
            <div class="col-md-4">
                <div class="card text-white bg-warning mb-3">
                    <div class="card-header bg-warning"></div>
                    <div class="card-body">
                      <h5 class="card-title">Total Balance</h5>
                      <!-- {% if 'user_id' in session: %}
                        <p>{{ session['user_id']}}</p>
                      {% endif %} -->
                      <p class="card-text">Rp. {{'{:,.0f}'.format(data.saldo)}}
                    </div>
                  </div>
            </div>
            <div class="col-md-4">
                <div class="card text-white bg-danger mb-3">
                    <div class="card-header bg-danger"></div>
                    <div class="card-body">
                      <h5 class="card-title">Total Income</h5>
                      <p class="card-text">Rp. {{'{:,.0f}'.format(data.total_income)}}</p>
                    </div>
                  </div>
            </div>
            <div class="col-md-4">
                <div class="card text-white bg-success mb-3">
                    <div class="card-header bg-success"></div>
                    <div class="card-body">
                      <h5 class="card-title">Total Outcome</h5>
                      <p class="card-text">Rp. {{'{:,.0f}'.format(data.total_outcome)}}</p>
                    </div>
                  </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
                <button class="btn btn-info mx-2 disabled" id="dailyButton" onclick="dailyButtonClick()">Daily</button>
                <button class="btn btn-success mx-2" id="monthlyButton" onclick="monthlyButtonClick()">Monthly</button>
            </div>
        </div>
        <div class="card mt-4">
            <div class="card-body">
                <div class="row">
                    <canvas id="myLineChart" width="600" height="250"></canvas>
                    <canvas id="myBarChart" class="d-none" width="600" height="250"></canvas>
                </div>
            </div>
        </div>
    </main>
    <!--end page main-->
    <script>
        // var months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        // var ctx = document.getElementById('myBarChart').getContext('2d');
        // var myBarChart = new Chart(ctx, {
        //     type: 'bar',
        //     data: {
        //         labels: months,
        //         datasets: [
        //             {
        //                 label: 'Income',
        //                 data: incomeData,
        //                 backgroundColor: 'blue'
        //             },
        //             {
        //                 label: 'Outcome',
        //                 data: outcomeData,
        //                 backgroundColor: 'red'
        //             }
        //         ]
        //     },
        //     options: {
        //         scales: {
        //             x: {
        //                 beginAtZero: true
        //             },
        //             y: {
        //                 beginAtZero: true,
        //                 min: 0,
        //                 max: 500000000
        //             }
        //         }
        //     }
        // });
    </script>
    <script>
      
    // Mendapatkan data pendapatan
    fetch('/query_data_income')
        .then(response => response.json())
        .then(incomeData => {
            // Proses data pendapatan
            fetch('/query_data_outcome')
                .then(response => response.json())
                .then(outcomeData => {
                    console.log(outcomeData)
                    // Proses data pengeluaran
                    processData(incomeData, outcomeData);
                })
                .catch(error => console.error('Error fetching outcome data:', error));
        })
        .catch(error => console.error('Error fetching income data:', error));

         // Mendapatkan data pendapatan
    fetch('/query_data_bulan')
        .then(response => response.json())
        .then(dataBulan => {
            // Proses data pendapatan
            fetch('/query_data_bulan')
                .then(response => response.json())
                .then(dataBulan => {
                    console.log(dataBulan)
                    // Proses data pengeluaran
                    processData2(dataBulan);
                })
                .catch(error => console.error('Error fetching outcome data:', error));
        })
        .catch(error => console.error('Error fetching income data:', error));

        function processData2(dataBulan) {
        // Ekstrak data dari JSON ke dalam arrays
        var months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
        var incomeValues = dataBulan.map(entry => entry.total_income);
        var outcomeValues = dataBulan.map(entry => entry.total_outcome); // Jika outcome diwakili sebagai nilai negatif
        var ctx = document.getElementById('myBarChart').getContext('2d');
        var myBarChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: months,
                datasets: [
                    {
                        label: 'Income',
                        data: incomeValues,
                        backgroundColor: 'blue'
                    },
                    {
                        label: 'Outcome',
                        data: outcomeValues,
                        backgroundColor: 'red'
                    }
                ]
            },
            options: {
                scales: {
                    x: {
                        beginAtZero: true
                    },
                    y: {
                        beginAtZero: true,
                        min: 0,
                    }
                }
            }
        });
    }
    function processData(incomeData, outcomeData) {
        // Ekstrak data dari JSON ke dalam arrays
        var dates = incomeData.map(entry => entry.tanggal);
        var incomeValues = incomeData.map(entry => entry.total_nominal);
        var outcomeValues = outcomeData.map(entry => entry.total_nominal); // Jika outcome diwakili sebagai nilai negatif

        // Buat Chart.js
        var ctx = document.getElementById('myLineChart').getContext('2d');
        var myLineChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: dates,
                datasets: [{
                    label: 'Income',
                    data: incomeValues,
                    borderColor: 'blue',
                    fill: false
                }, {
                    label: 'Outcome',
                    data: outcomeValues,
                    borderColor: 'red',
                    fill: false
                }]
            },
            options: {
                scales: {
                    x: {
                        type: 'category',
                        labels: dates
                    },
                    y: {
                        beginAtZero: true,
                        min: 0
                    }
                }
            }
        });
    }

        function dailyButtonClick() {
            $('#dailyButton').addClass('disabled');
            $('#monthlyButton').removeClass('disabled');

            $('#myLineChart').removeClass('d-none');
            $('#myBarChart').addClass('d-none');
            
        }

        function monthlyButtonClick() {
            $('#monthlyButton').addClass('disabled');
            $('#dailyButton').removeClass('disabled');
            $('#myBarChart').removeClass('d-none');
            $('#myLineChart').addClass('d-none');
        }
    </script>
    <!-- Include the footer -->
    {% include 'layout/footer.html' %}
{% endblock %}
